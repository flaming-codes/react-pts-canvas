{"version":3,"file":"index.es.js","sources":["../src/legacy.tsx","../src/index.tsx"],"sourcesContent":["/* eslint-disable react/prop-types */\nimport React from 'react'\nimport { CanvasSpace, CanvasForm, Bound, Group, IPlayer } from 'pts'\n\nexport type PtsCanvasLegacyProps = {\n  name?: string\n  background?: string\n  resize?: boolean\n  retina?: boolean\n  play?: boolean\n  touch?: boolean\n  style?: object\n  canvasStyle?: object\n}\n\nexport type QuickStartProps = PtsCanvasLegacyProps & {\n  onStart?: (bound?: Bound, space?: CanvasSpace) => void\n  onAnimate?: (\n    space?: CanvasSpace,\n    form?: CanvasForm,\n    time?: number,\n    ftime?: number\n  ) => void\n  onResize?: (\n    space?: CanvasSpace,\n    form?: CanvasForm,\n    size?: Group,\n    evt?: Event\n  ) => void\n  onAction?: (\n    space?: CanvasSpace,\n    form?: CanvasForm,\n    type?: string,\n    px?: number,\n    py?: number,\n    evt?: Event\n  ) => void\n}\n\nexport class PtsCanvas<T> extends React.Component<PtsCanvasLegacyProps & T> {\n  canvRef: React.RefObject<Element>\n  space: CanvasSpace | null\n  form: CanvasForm | null\n  _touch: boolean\n\n  static defaultProps = {\n    name: 'pts-react', // maps to className of the container div\n    background: '#9ab',\n    resize: true,\n    retina: true,\n    play: true,\n    touch: true,\n    style: {},\n    canvasStyle: {}\n  }\n\n  constructor(props: T) {\n    super(props)\n    this.canvRef = React.createRef()\n    this.space = null\n    this.form = null\n    this._touch = false\n  }\n\n  componentDidMount() {\n    this.init()\n    this._update()\n  }\n\n  componentDidUpdate() {\n    this._update()\n  }\n\n  componentWillUnmount() {\n    if (!this.space) return\n    this.space.dispose()\n  }\n\n  _update() {\n    if (!this.space) return\n    if (this.props.play) {\n      this.space.play()\n    } else {\n      this.space.playOnce(0)\n    }\n\n    if (this._touch !== this.props.touch) {\n      this._touch = this.props.touch || false\n      this.space.bindMouse(this._touch).bindTouch(this._touch)\n    }\n  }\n\n  // Required: Override this to use Pts' player `animate` callback\n  // See guide: https://ptsjs.org/guide/space-0500\n  animate(time: number, ftime: number) {\n    if (!this.form || !this.space) return\n    this.form.point(this.space.pointer, 20, 'circle')\n  }\n\n  // Optional: Override this to use Pts' player `start` callback\n  start(bound: Bound, space: CanvasSpace) { console.log('Start callback') }\n\n  // Optional: Override this to use Pts' player `resize` callback\n  resize(size: Group, evt: Event) { console.log('Resize callback') }\n\n  // Optional: Override this to use Pts' player `action` callback\n  action(type: string, px: number, py: number, evt: Event) { console.log('Action callback') }\n\n  init() {\n    if (!this.canvRef.current) return\n    this.space = new CanvasSpace(this.canvRef.current).setup({\n      bgcolor: this.props.background,\n      resize: this.props.resize,\n      retina: this.props.retina\n    })\n\n    this.form = this.space.getForm()\n    this.space.add(this as IPlayer)\n  }\n\n  render() {\n    return (\n      <div className={this.props.name || ''} style={this.props.style}>\n        <canvas\n          className={this.props.name ? this.props.name + '-canvas' : ''}\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n          // @ts-ignore\n          ref={this.canvRef}\n          style={this.props.canvasStyle}\n        />\n      </div>\n    )\n  }\n}\n\nexport class QuickStartCanvas extends PtsCanvas<QuickStartProps> {\n  static defaultProps = {\n    name: 'pts-react', // maps to className of the container div\n    background: '#9ab',\n    resize: true,\n    retina: true,\n    play: true,\n    touch: true,\n    style: {},\n    canvasStyle: {},\n    onStart: undefined,\n    onAnimate: undefined,\n    onResize: undefined,\n    onAction: undefined\n  }\n\n  override animate(time: number, ftime: number) {\n    if (!this.space || !this.form) return\n    if (this.props.onAnimate) {\n      this.props.onAnimate(this.space, this.form, time, ftime)\n    }\n  }\n\n  override start(bound: Bound, space: CanvasSpace) {\n    if (this.props.onStart) this.props.onStart(bound, space)\n  }\n\n  override resize(size: Group, evt: Event) {\n    if (this.props.onResize) {\n      this.props.onResize(this.space || undefined, this.form || undefined, size, evt)\n    }\n  }\n\n  override action(type: string, px: number, py: number, evt: Event) {\n    if (this.props.onAction) {\n      this.props.onAction(this.space || undefined, this.form || undefined, type, px, py, evt)\n    }\n  }\n}\n","/* eslint-disable  react/prop-types */\nimport React, { useEffect, useRef, forwardRef, ForwardedRef } from 'react'\nimport { CanvasSpace, Bound, CanvasForm, Group, Tempo } from 'pts'\n\nexport type HandleStartFn = (\n  bound: Bound,\n  space: CanvasSpace,\n  form: CanvasForm\n) => void\n\nexport type HandleAnimateFn = (\n  space: CanvasSpace,\n  form: CanvasForm,\n  time: number,\n  ftime: number\n) => void\n\nexport type HandleResizeFn = (\n  space: CanvasSpace,\n  form: CanvasForm,\n  size: Group,\n  evt: Event // eslint-disable-line no-undef\n) => void\n\nexport type HandleActionFn = (\n  space: CanvasSpace,\n  form: CanvasForm,\n  type: string,\n  px: number,\n  py: number,\n  evt: Event // eslint-disable-line no-undef\n) => void\n\nexport type PtsCanvasProps = {\n  name?: string\n  background?: string\n  resize?: boolean\n  retina?: boolean\n  play?: boolean\n  touch?: boolean\n  style?: object // eslint-disable-line no-undef\n  canvasStyle?: object // eslint-disable-line no-undef\n  onStart?: HandleStartFn\n  onAnimate: HandleAnimateFn\n  onResize?: HandleResizeFn\n  onAction?: HandleActionFn\n  tempo?: Tempo\n}\n\nconst PtsCanvasComponent = (\n  {\n    name = 'pts-react', // maps to className of the container div\n    background = '#9ab',\n    resize = true,\n    retina = true,\n    play = true,\n    touch = true,\n    style = {},\n    canvasStyle = {},\n    onStart = undefined,\n    onAnimate = () => {\n      console.log('animating')\n    },\n    onResize = undefined,\n    onAction = undefined,\n    tempo = undefined\n  }: PtsCanvasProps,\n  ref: ForwardedRef<HTMLCanvasElement>\n) => {\n  // Set canvRef to be either the forwarded ref if its a MutableRefObject, or our own local ref otherwise\n  const canvRef = ref && typeof ref !== 'function' ? ref : useRef(null)\n  const spaceRef = useRef<CanvasSpace>()\n  const formRef = useRef<CanvasForm>()\n\n  /**\n   * When canvRef Updates (ready for space)\n   */\n  useEffect(() => {\n    if (!canvRef || !canvRef.current) return\n    // Create CanvasSpace with the canvRef and assign to spaceRef\n    // Add animation, tempo, and play when ready (call back on CanvasSpace constructor)\n    spaceRef.current = new CanvasSpace(canvRef.current).setup({\n      bgcolor: background,\n      resize,\n      retina\n    })\n\n    // Assign formRef\n    formRef.current = spaceRef.current.getForm()\n\n    // By having individual handler props, we can expose what we need to the\n    // underlying functions, like our Form instance\n    spaceRef.current.add({\n      start: (bound: Bound) => {\n        if (onStart && spaceRef.current && formRef.current) {\n          onStart(bound, spaceRef.current, formRef.current)\n        }\n      },\n      animate: (time?: number, ftime?: number) => {\n        if (time && ftime && spaceRef.current && formRef.current) {\n          onAnimate(spaceRef.current, formRef.current, time, ftime)\n        }\n      },\n      resize: (bound: Bound, event: Event) => {\n        if (onResize && spaceRef.current && formRef.current) {\n          onResize(spaceRef.current, formRef.current, bound, event)\n        }\n      },\n      action: (type: string, px: number, py: number, evt: Event) => {\n        if (onAction && spaceRef.current && formRef.current) {\n          onAction(spaceRef.current, formRef.current, type, px, py, evt)\n        }\n      }\n    })\n\n    // Add tempo if provided\n    if (tempo) {\n      spaceRef.current.add(tempo)\n    }\n\n    // Return the cleanup function (similar to ComponentWillUnmount)\n    return () => {\n      spaceRef.current && spaceRef.current.dispose()\n    }\n  }, [canvRef])\n\n  /**\n   * When Touch updates\n   */\n  useEffect(() => {\n    spaceRef.current && spaceRef.current.bindMouse(touch).bindTouch(touch)\n  }, [touch])\n\n  /**\n   * Play or stop based on play prop\n   * */\n  const maybePlay = () => {\n    if (play) {\n      spaceRef.current && spaceRef.current.play()\n    } else {\n      spaceRef.current && spaceRef.current.playOnce(0)\n    }\n  }\n\n  /**\n   * When anything updates\n   */\n  useEffect(() => {\n    maybePlay()\n  })\n\n  return (\n    <div className={name || ''} style={style}>\n      <canvas\n        className={name ? name + '-canvas' : ''}\n        ref={canvRef}\n        style={canvasStyle}\n      />\n    </div>\n  )\n}\n\nexport const PtsCanvas = forwardRef<HTMLCanvasElement, PtsCanvasProps>(\n  PtsCanvasComponent\n)\n\nexport {\n  PtsCanvas as PtsCanvasLegacy,\n  QuickStartCanvas as QuickStartCanvasLegacy,\n  PtsCanvasLegacyProps,\n  QuickStartProps\n} from './legacy'\n"],"names":["PtsCanvas"],"mappings":";;;AAAA;MAuCaA,WAAa,SAAQ,KAAK,CAAC,SAAmC;IAiBzE,YAAY,KAAQ;QAClB,KAAK,CAAC,KAAK,CAAC,CAAA;QACZ,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC,SAAS,EAAE,CAAA;QAChC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAA;QACjB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;QAChB,IAAI,CAAC,MAAM,GAAG,KAAK,CAAA;KACpB;IAED,iBAAiB;QACf,IAAI,CAAC,IAAI,EAAE,CAAA;QACX,IAAI,CAAC,OAAO,EAAE,CAAA;KACf;IAED,kBAAkB;QAChB,IAAI,CAAC,OAAO,EAAE,CAAA;KACf;IAED,oBAAoB;QAClB,IAAI,CAAC,IAAI,CAAC,KAAK;YAAE,OAAM;QACvB,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAA;KACrB;IAED,OAAO;QACL,IAAI,CAAC,IAAI,CAAC,KAAK;YAAE,OAAM;QACvB,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE;YACnB,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAA;SAClB;aAAM;YACL,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAA;SACvB;QAED,IAAI,IAAI,CAAC,MAAM,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE;YACpC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,IAAI,KAAK,CAAA;YACvC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;SACzD;KACF;;;IAID,OAAO,CAAC,IAAY,EAAE,KAAa;QACjC,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK;YAAE,OAAM;QACrC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,EAAE,EAAE,QAAQ,CAAC,CAAA;KAClD;;IAGD,KAAK,CAAC,KAAY,EAAE,KAAkB,IAAI,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAA,EAAE;;IAGzE,MAAM,CAAC,IAAW,EAAE,GAAU,IAAI,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAA,EAAE;;IAGlE,MAAM,CAAC,IAAY,EAAE,EAAU,EAAE,EAAU,EAAE,GAAU,IAAI,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAA,EAAE;IAE3F,IAAI;QACF,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO;YAAE,OAAM;QACjC,IAAI,CAAC,KAAK,GAAG,IAAI,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC;YACvD,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU;YAC9B,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM;YACzB,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM;SAC1B,CAAC,CAAA;QAEF,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAA;QAChC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAe,CAAC,CAAA;KAChC;IAED,MAAM;QACJ,QACE,6BAAK,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,IAAI,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK;YAC5D,gCACE,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,SAAS,GAAG,EAAE;;;gBAG7D,GAAG,EAAE,IAAI,CAAC,OAAO,EACjB,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,WAAW,GAC7B,CACE,EACP;KACF;;AAvFMA,wBAAY,GAAG;IACpB,IAAI,EAAE,WAAW;IACjB,UAAU,EAAE,MAAM;IAClB,MAAM,EAAE,IAAI;IACZ,MAAM,EAAE,IAAI;IACZ,IAAI,EAAE,IAAI;IACV,KAAK,EAAE,IAAI;IACX,KAAK,EAAE,EAAE;IACT,WAAW,EAAE,EAAE;CAChB,CAAA;MAiFU,gBAAiB,SAAQA,WAA0B;IAgBrD,OAAO,CAAC,IAAY,EAAE,KAAa;QAC1C,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,IAAI;YAAE,OAAM;QACrC,IAAI,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE;YACxB,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,KAAK,CAAC,CAAA;SACzD;KACF;IAEQ,KAAK,CAAC,KAAY,EAAE,KAAkB;QAC7C,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO;YAAE,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,CAAA;KACzD;IAEQ,MAAM,CAAC,IAAW,EAAE,GAAU;QACrC,IAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE;YACvB,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,IAAI,SAAS,EAAE,IAAI,CAAC,IAAI,IAAI,SAAS,EAAE,IAAI,EAAE,GAAG,CAAC,CAAA;SAChF;KACF;IAEQ,MAAM,CAAC,IAAY,EAAE,EAAU,EAAE,EAAU,EAAE,GAAU;QAC9D,IAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE;YACvB,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,IAAI,SAAS,EAAE,IAAI,CAAC,IAAI,IAAI,SAAS,EAAE,IAAI,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,CAAC,CAAA;SACxF;KACF;;AApCM,6BAAY,GAAG;IACpB,IAAI,EAAE,WAAW;IACjB,UAAU,EAAE,MAAM;IAClB,MAAM,EAAE,IAAI;IACZ,MAAM,EAAE,IAAI;IACZ,IAAI,EAAE,IAAI;IACV,KAAK,EAAE,IAAI;IACX,KAAK,EAAE,EAAE;IACT,WAAW,EAAE,EAAE;IACf,OAAO,EAAE,SAAS;IAClB,SAAS,EAAE,SAAS;IACpB,QAAQ,EAAE,SAAS;IACnB,QAAQ,EAAE,SAAS;CACpB;;ACrJH;AAiDA,MAAM,kBAAkB,GAAG,CACzB,EACE,IAAI,GAAG,WAAW;AAClB,UAAU,GAAG,MAAM,EACnB,MAAM,GAAG,IAAI,EACb,MAAM,GAAG,IAAI,EACb,IAAI,GAAG,IAAI,EACX,KAAK,GAAG,IAAI,EACZ,KAAK,GAAG,EAAE,EACV,WAAW,GAAG,EAAE,EAChB,OAAO,GAAG,SAAS,EACnB,SAAS,GAAG;IACV,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAA;AAC1B,CAAC,EACD,QAAQ,GAAG,SAAS,EACpB,QAAQ,GAAG,SAAS,EACpB,KAAK,GAAG,SAAS,EACF,EACjB,GAAoC;;IAGpC,MAAM,OAAO,GAAG,GAAG,IAAI,OAAO,GAAG,KAAK,UAAU,GAAG,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAA;IACrE,MAAM,QAAQ,GAAG,MAAM,EAAe,CAAA;IACtC,MAAM,OAAO,GAAG,MAAM,EAAc,CAAA;;;;IAKpC,SAAS,CAAC;QACR,IAAI,CAAC,OAAO,IAAI,CAAC,OAAO,CAAC,OAAO;YAAE,OAAM;;;QAGxC,QAAQ,CAAC,OAAO,GAAG,IAAI,WAAW,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC;YACxD,OAAO,EAAE,UAAU;YACnB,MAAM;YACN,MAAM;SACP,CAAC,CAAA;;QAGF,OAAO,CAAC,OAAO,GAAG,QAAQ,CAAC,OAAO,CAAC,OAAO,EAAE,CAAA;;;QAI5C,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC;YACnB,KAAK,EAAE,CAAC,KAAY;gBAClB,IAAI,OAAO,IAAI,QAAQ,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,EAAE;oBAClD,OAAO,CAAC,KAAK,EAAE,QAAQ,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,CAAC,CAAA;iBAClD;aACF;YACD,OAAO,EAAE,CAAC,IAAa,EAAE,KAAc;gBACrC,IAAI,IAAI,IAAI,KAAK,IAAI,QAAQ,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,EAAE;oBACxD,SAAS,CAAC,QAAQ,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,EAAE,IAAI,EAAE,KAAK,CAAC,CAAA;iBAC1D;aACF;YACD,MAAM,EAAE,CAAC,KAAY,EAAE,KAAY;gBACjC,IAAI,QAAQ,IAAI,QAAQ,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,EAAE;oBACnD,QAAQ,CAAC,QAAQ,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,EAAE,KAAK,EAAE,KAAK,CAAC,CAAA;iBAC1D;aACF;YACD,MAAM,EAAE,CAAC,IAAY,EAAE,EAAU,EAAE,EAAU,EAAE,GAAU;gBACvD,IAAI,QAAQ,IAAI,QAAQ,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,EAAE;oBACnD,QAAQ,CAAC,QAAQ,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,EAAE,IAAI,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,CAAC,CAAA;iBAC/D;aACF;SACF,CAAC,CAAA;;QAGF,IAAI,KAAK,EAAE;YACT,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;SAC5B;;QAGD,OAAO;YACL,QAAQ,CAAC,OAAO,IAAI,QAAQ,CAAC,OAAO,CAAC,OAAO,EAAE,CAAA;SAC/C,CAAA;KACF,EAAE,CAAC,OAAO,CAAC,CAAC,CAAA;;;;IAKb,SAAS,CAAC;QACR,QAAQ,CAAC,OAAO,IAAI,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,CAAA;KACvE,EAAE,CAAC,KAAK,CAAC,CAAC,CAAA;;;;IAKX,MAAM,SAAS,GAAG;QAChB,IAAI,IAAI,EAAE;YACR,QAAQ,CAAC,OAAO,IAAI,QAAQ,CAAC,OAAO,CAAC,IAAI,EAAE,CAAA;SAC5C;aAAM;YACL,QAAQ,CAAC,OAAO,IAAI,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAA;SACjD;KACF,CAAA;;;;IAKD,SAAS,CAAC;QACR,SAAS,EAAE,CAAA;KACZ,CAAC,CAAA;IAEF,QACE,6BAAK,SAAS,EAAE,IAAI,IAAI,EAAE,EAAE,KAAK,EAAE,KAAK;QACtC,gCACE,SAAS,EAAE,IAAI,GAAG,IAAI,GAAG,SAAS,GAAG,EAAE,EACvC,GAAG,EAAE,OAAO,EACZ,KAAK,EAAE,WAAW,GAClB,CACE,EACP;AACH,CAAC,CAAA;MAEY,SAAS,GAAG,UAAU,CACjC,kBAAkB;;;;"}